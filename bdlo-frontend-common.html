<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icons/device-icons.html">
<link rel="import" href="../iron-icons/editor-icons.html">

<link rel="import" href="../iron-pages/iron-pages.html">

<link rel="import" href="../paper-menu-button/paper-menu-button.html">
<link rel="import" href="../paper-fab/paper-fab.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">
<link rel="import" href="../paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../paper-toast/paper-toast.html">
<link rel="import" href="../paper-spinner/paper-spinner.html">
<link rel="import" href="../paper-spinner/paper-spinner-lite.html">
<link rel="import" href="../paper-badge/paper-badge.html">
<link rel="import" href="../paper-tooltip/paper-tooltip.html">
<link rel="import" href="../paper-tabs/paper-tabs.html">
<link rel="import" href="../paper-checkbox/paper-checkbox.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-slider/paper-slider.html">
<link rel="import" href="../paper-input/paper-textarea.html">

<link rel="import" href="util-behavior.html">
<link rel="import" href="editor-behavior.html">
<link rel="import" href="fc-input-image.html">
<link rel="import" href="documents-edit-table.html">
<link rel="import" href="ui-dialog.html">
<link rel="import" href="ui-pager.html">
<link rel="import" href="ui-phone.html">
<link rel="import" href="ui-disconnect-warning.html">

<script src="../lodash/dist/lodash.min.js"></script>
<script src="../moment/min/moment.min.js"></script>
<script src="../moment/locale/ru.js"></script>
<script src="../revalidator/lib/revalidator.js"></script>
<script src="../namitos-fc/fc.js"></script>
<script src="../socket.io-client/socket.io.js"></script>

<script src="util.js"></script>
<script>
	fc.widgets.selectCollection = function (obj, schema) {
		var el = util.dom.el('div');
		var input = util.dom.el('select', {}, util.dom.el('option'));
		var StructureClass = eval(schema.model);
		StructureClass.read().then(function (items) {
			if (schema.filter instanceof Function) {
				items = items.filter(schema.filter);
			}
			if (schema.sort instanceof Function) {
				items = items.sort(schema.sort);
			}
			items.forEach(function (item) {
				var el = util.dom.el('option', {
					attributes: {
						value: item._id
					}
				}, item.name || item.shortname || item.shortName || item.short_name || item.fullname || item.fullName || item.full_name || item.title || item.text || item.value || item.alias || item._id);
				if (item._id == obj) {
					el.setAttribute('selected', true);
				}
				input.appendChild(el);
			});
		}).catch(err);
		el.appendChild(input);
		return {
			wrapper: el,
			input: input
		}
	};

	fc.widgets.base64Image = function (obj, schema) {
		var el = util.dom.el('div');
		var input = util.dom.el('fc-input-image', {
			value: obj
		});
		el.appendChild(input);
		return {
			wrapper: el,
			input: input
		}
	};

	fc.widgets.unixDateTime = function (obj, schema) {
		if (window.moment) {
			var el = util.dom.el('div');
			var input = util.dom.el('input', {
				attributes: {
					type: 'datetime-local'
				}
			});
			el.appendChild(input);
			input.value = obj ? moment(obj).format("YYYY-MM-DDTHH:mm") : '';
			input.convertValue = function (value) {
				return value ? moment(value, "YYYY-MM-DDTHH:mm").toDate().valueOf() : 0;
			};
			return {
				wrapper: el,
				input: input
			}
		} else {
			console.error('unixDateTime widget requires momentjs');
		}
	}
</script>
