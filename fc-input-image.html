<dom-module id="fc-input-image">
	<template>
		<style>
			:host {
				overflow: hidden;
				min-height: 25px;
			}

			:host:after {
				display: block;
				clear: both;
				content: '';
			}

			img {
				width: auto;
				height: 100px;
				float: left;
			}

			paper-progress {
				width: 100%;
			}
		</style>
		<template is="dom-if" if="[[loading]]">
			<paper-progress max="[[total]]" value="[[loaded]]"></paper-progress>
		</template>
		<template is="dom-if" if="[[error]]">
			<div>[[error]]</div>
		</template>
		<template is="dom-if" if="[[!loading]]">
			<template is="dom-if" if="[[value.0]]">
				<template is="dom-if" if="[[_isBase64File(value.0)]]">
					<img src="[[value.0]]">
				</template>
				<template is="dom-if" if="[[!_isBase64File(value.0)]]">
					<img src="/[[value.0]]">
				</template>
			</template>
			<template is="dom-if" if="[[!value.0]]">
				<input type="file" on-change="getImage">
			</template>
		</template>

	</template>
	<script>
		Polymer({
			is: 'fc-input-image',
			properties: {
				loading: {
					type: Boolean,
					value: false
				},
				value: {
					type: Array,
					value: function () {
						return []
					}
				},
				loaded: {
					type: Number
				},
				total: {
					type: Number
				}
			},
			getImage: function (e) {
				this.loading = true;
				var view = this;
				var input = e.target;
				var reader = new FileReader();
				reader.onload = function (a) {
					view.set('value', [a.target.result]);
					view.changeField();
					view.loading = false;
				};
				reader.onprogress = function (a) {
					view.total = a.total;
					view.loaded = a.loaded;
				};
				reader.onerror = function (a) {
					view.error = a.toString();
				};
				reader.readAsDataURL(input.files[0]);
			},
			_isBase64File: function (str) {
				if (!str) {
					return false;
				}
				var a = str.substr(0, 5);
				return a.indexOf('data:') != -1;
			}
		})
	</script>
</dom-module>
